# 站会提醒-技术方案

## 业务定义
每天发送一个通知，用于提醒当前站会的主持人是谁

## 业务流程
1. 先读取config.json配置文件，示例：
    ```json
    {
        "persons": [
            "张三",
            "李四",
            "王五"
        ],
        "first_data": 20260102,
        "first_index": 1
    }
    ```
    说明：
    - persons：站会主持人列表
    - first_data：第一个站会的日期，数字格式，格式为yyyyMMdd文本转数字
    - first_index：第一个站会的主持人在persons列表中的索引，从0开始

1. 获取姐节假日列表holidays_[year].json，示例：
    ```json
    [20260101, 20260102, 20260103]
    ```
    说明：
    - 数组元素是节假日日期，数字格式，格式为yyyyMMdd文本转数字
    - 文件名中的[year]是年份，例如2026年的节假日列表文件名是holidays_2026.json

1. 如果holidays_[year].json文件不存在，此时需要生成有效的holidays_[year].json文件：
    - 调用接口获取节假日列表：`GET https://api.apihubs.cn/holiday/get?field=date&year={year}&workday=2&size=3660`，{year}需要替换为具体的年份，响应示例：
        ```json
        {"code": 0, "msg": "ok", "data": {"list": [{"date": 20261227}, {"date": 20261226}, {"date": 20261220}, {"date": 20261219}, {"date": 20261213}], "page": 1, "size": 3660, "total": 117}}
        ```
    - 从响应中提取data.list数组，元素的每个date字段，即为节假日，数字格式，最后统一保存到holidays_[year].json文件中
    - 如果接口报错，则将错误记录到error.log文件中，结束程序

1. 如果当天是节假日，此时不发送通知，直接返回即可

1. 如果当天不是节假日，需要发送通知，需要算出当前站会的主持人是谁
    - 先根据first_data和first_index，计算出当前站会的日期current_date
    - 再根据current_date和persons列表，计算出当前站会的主持人current_person
    - 还需要算出下一个工作日（非节假日）next_date，以及对应的主持人next_person
    - 注意下一个站会的日期next_date，可能会在当前年的下一年，这种情况需要获取holidays_[year + 1].json，如果接口报错，则将错误记录到error.log文件中，但不要结束，就当作找不到下一个站会主持人

1. 准备通知文本，如果可以找到下一个站会主持人，通知文本为：
    ```
    站会提醒：今天由 {current_person} 主持站会，下一次 {next_date} 由 {next_person} 主持
    ```
    如果找不到下一个站会主持人，通知文本为：
    ```
    站会提醒：今天由 {current_person} 主持站会
    ```
    说明：
    - {current_person}：当前站会的主持人
    - {next_date}：下一个站会的日期，格式为yyyy-MM-dd，不是原始数据中的纯数字
    - {next_person}：下一个站会的主持人

1. 发送通知`POST https://hooks.slack.com/triggers/xxxxxxxxxx`，请求体格式为：
    ```json
    {
        "msg": 通知文本
    }
    ```



