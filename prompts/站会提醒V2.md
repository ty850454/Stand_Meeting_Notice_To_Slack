# 站会提醒V2-技术方案

## 业务定义
每天发送一个通知，用于提醒当前站会的主持人是谁

## 流程
1. 先读取config.json配置文件，示例：
    ```json
    {
        "persons": [
            "张三",
            "李四",
            "王五"
        ],
        "first_data": 20260102,
        "first_index": 1,
        "slackUrl": "https://hooks.slack.com/triggers/xxxxxxxxxxxx",
        "data_file": "data.json"
    }
    ```
    说明：
    - persons：站会主持人列表
    - first_data：第一个站会的日期，数字格式，格式为yyyyMMdd文本转数字
    - first_index：第一个站会的主持人在persons列表中的索引，从0开始
    - slackUrl：slack通知的webhook url，用于发送通知，可以不填，默认输出日志
    - data_file：通知数据文件名，可以不填，默认是data.json


1. 获取通知数据json文件，文件名为配置中的data_file，内容示例：
    ```json
    {
        "date": {
            "20260112": {
                "person": 0,
                "next": 20260114
            },
            "20260113": {
                "person": -1,
                "next": 20260114
            }
        },
        "lastUpdated": 20260112,
        "persons": [
            "张三",
            "李四",
            "王五"
        ]
    }
    ```
    说明：
    - date：站会日期，数字格式，格式为yyyyMMdd文本转数字，date不存在的日期表示为节假日，不需要发送通知
    - person：站会主持人在persons列表中的索引，从0开始，-1表示节假日
    - next：下一个站会日期，数字格式，格式为yyyyMMdd文本转数字
    - lastUpdated：最后更新日期，数字格式，格式为yyyyMMdd文本转数字，用于判断是否需要更新数据文件
    - persons：站会主持人列表，与配置中的persons保持一致，后续不从配置中读取，而是从这里获取

1. 数据json文件，或上次更新是一个月前，此时需要生成有效的数据json文件：
    
    1. 获取开始日期，如果数据json文件已存在，且可以获取到当天数据（如果是工作日则可以直接获取到pserson索引，如果是节假日则可以通过next获取到下一个工作日的person索引），如果拿不到，则使用配置中的first_data和first_index，first_data作为开始日期，开始日期一定要是当年或上一年的日期，结束日期固定为当天+100天
    1. 获取节假日数据，如果开始日期是上一年，则获取获取上一年、当年和下一年的3年节假日数据，如果开始日期是当年，则获取当年和下一年2年的数据
    1. 从开始日期，遍历到结束日期，判断每一天是否是节假日，如果不是节假日：则将该日期添加到date字段中，person字段为当前站会主持人，next会在后续的循环中更新


